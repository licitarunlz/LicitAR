@model IEnumerable<LicitAR.Core.Data.Models.UsuarioModel>

@{
    ViewData["Title"] = "Usuarios - LicitAR";
}

<div class="card">
    <h5 class="card-header">Usuarios</h5>
    <div class="table-responsive text-nowrap">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Email</th>
                    <th>Fecha de Nacimiento</th> 
                    <th>CUIT</th>
                    <th>Habilitado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody class="table-border-bottom-0">
                @foreach (var user in Model)
                {
                    <tr>
                        <td>@user.IdUsuario</td>
                        <td>@user.Nombre</td>
                        <td>@user.Apellido</td>
                        <td>@user.Email</td>
                        <td>@user.FechaNacimiento.ToShortDateString()</td>
                        <td>@user.CuitFormateado</td>
                        <td>
                            @if (user.Enabled)
                            {
                                <span class="badge bg-success">Sí</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">No</span>
                            }
                        </td>
                        <td>
                            <div class="dropdown">
                                <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                                    <i class="bx bx-dots-vertical-rounded"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" asp-action="Edit" asp-route-id="@user.IdUsuario">
                                        <i class="bx bx-edit-alt me-1"></i> Editar
                                    </a>
                                    <a class="dropdown-item" href="javascript:void(0);" onclick="confirmToggleEnabled('@user.IdUsuario', @(user.Enabled ? "false" : "true"))">
                                        <i class="bx bx-trash me-1"></i> @(user.Enabled ? "Deshabilitar" : "Habilitar")
                                    </a>
                                </div>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section PageScripts {
    <script>
        function confirmToggleEnabled(userId, enabled) {
            const action = enabled ? "habilitar" : "deshabilitar";
            if (confirm(`¿Desea ${action} este usuario?`)) {
                const form = document.createElement("form");
                form.method = "post";
                form.action = `/Usuario/ToggleEnabled?id=${userId}&enabled=${enabled}`;
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
}